FROM node:24-slim

RUN apt-get update && apt-get install -y \
  openssl \
  ca-certificates \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app

RUN npm install -g pnpm

COPY package.json pnpm-lock.yaml* ./
COPY pnpm-workspace.yaml* ./
COPY .pnpmrc ./

RUN pnpm install

COPY . .

RUN pnpm db:generate

RUN mkdir -p /app/uploads

EXPOSE 3000
EXPOSE 5555

ENV NODE_ENV=development
ENV PORT=3000

CMD ["pnpm", "dev"]
